<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Es Krim - Pelanggan Setia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #f8fafc;
        }

        .product-card:hover .product-img {
            transform: scale(1.1);
        }

        .cart-badge {
            top: -8px;
            right: -8px;
        }
    </style>
</head>

<body class="bg-sky-50">
    <!-- Navbar -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-sky-600 flex items-center gap-2">
                <span>üç¶</span> Ice Cream Delight
            </h1>
            <div class="flex items-center gap-4">
                <button onclick="changeRole()" class="text-xs text-sky-500 hover:underline">Ganti Peran</button>
                <div class="relative cursor-pointer" onclick="toggleCartSidebar()">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-sky-600" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    <span id="cart-count"
                        class="cart-badge absolute bg-red-500 text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full font-bold">0</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <header class="bg-sky-500 text-white py-12 px-4 mb-8">
        <div class="max-w-7xl mx-auto text-center">
            <h2 class="text-3xl md:text-5xl font-bold mb-4">Pilih Kelezatan Favoritmu!</h2>
            <p class="text-sky-100 text-lg">Pesan sekarang, kami kirimkan kebahagiaan ke rumah Anda.</p>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 pb-20">
        <div id="product-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 md:gap-6">
            <!-- Products will be loaded here -->
        </div>
    </main>

    <!-- Cart Sidebar (Offcanvas) -->
    <div id="cart-sidebar"
        class="fixed inset-y-0 right-0 w-full md:w-96 bg-white shadow-2xl transform translate-x-full transition-transform duration-300 z-[60] flex flex-col">
        <div class="p-6 border-b flex justify-between items-center bg-sky-600 text-white">
            <h3 class="text-xl font-bold">Keranjang Belanja</h3>
            <button onclick="toggleCartSidebar()" class="text-2xl">&times;</button>
        </div>
        <div id="cart-items" class="flex-grow overflow-y-auto p-6 space-y-4">
            <!-- Cart items will be loaded here -->
        </div>
        <div class="p-6 border-t bg-gray-50">
            <div class="flex justify-between items-center mb-6 text-xl font-bold text-sky-900">
                <span>Total:</span>
                <span id="cart-total">Rp 0</span>
            </div>
            <button onclick="showCheckoutForm()"
                class="w-full bg-sky-500 hover:bg-sky-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg">
                Checkout Pesanan
            </button>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkout-modal"
        class="fixed inset-0 bg-black bg-opacity-50 z-[70] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl max-w-lg w-full max-h-[90vh] overflow-y-auto p-8 relative">
            <button onclick="closeCheckoutModal()" class="absolute top-4 right-6 text-3xl">&times;</button>
            <h3 class="text-2xl font-bold text-sky-900 mb-6 text-center">Form Pemesanan</h3>
            <form id="order-form" onsubmit="handleOrder(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Nama Lengkap</label>
                    <input type="text" id="cust-name" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-sky-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Nomor WhatsApp</label>
                    <input type="tel" id="cust-wa" required placeholder="08xxxx"
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-sky-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Alamat Lengkap</label>
                    <textarea id="cust-address" required rows="3"
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-sky-500 outline-none"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Catatan (Opsional)</label>
                    <textarea id="cust-notes" rows="2"
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-sky-500 outline-none"
                        placeholder="Contoh: Titip ke satpam ya"></textarea>
                </div>
                <div class="pt-4">
                    <button type="submit"
                        class="w-full bg-green-500 hover:bg-green-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M17.472 14.382c-.022-.037-.043-.075-.064-.113-.021-.038-.042-.076-.062-.115-.02-.039-.04-.078-.059-.117-.019-.04-.038-.08-.056-.12-.018-.041-.035-.083-.052-.124-.017-.042-.032-.084-.047-.127-.015-.043-.029-.086-.042-.13-.013-.044-.025-.088-.036-.133-.011-.045-.021-.091-.03-.137-.009-.046-.016-.093-.023-.14-.007-.047-.013-.095-.018-.143-.005-.048-.009-.096-.012-.145-.003-.049-.005-.098-.007-.148a10.99 10.99 0 0 1 .01-1.442c.003-.049.006-.098.01-.147.004-.049.008-.098.013-.146.005-.048.011-.096.018-.144.007-.048.015-.095.023-.142.008-.047.018-.093.029-.14.01-.046.02-.092.032-.137.012-.045.025-.089.037-.134.013-.044.027-.088.042-.131.015-.043.03-.086.046-.129.016-.042.033-.085.051-.127.017-.041.036-.082.055-.123.018-.041.038-.081.058-.12.019-.039.041-.078.062-.117.022-.038.043-.076.066-.113.022-.037.046-.073.07-.11.023-.036-.048-.073-.072-.11l.001.001zM12.035 0C5.408 0 .022 5.385.022 12.01c0 2.112.553 4.1 1.522 5.823L.053 23.492c-.085.31.206.591.511.498l5.772-1.748c1.724.896 3.682 1.408 5.758 1.408 6.627 0 12.012-5.384 12.012-12.01S18.662 0 12.035 0zm6.182 17.294c-.212.601-1.077 1.096-1.478 1.135-.61.059-1.393.184-4.14-1.006-3.51-1.517-5.77-5.071-5.945-5.304-.175-.233-1.408-1.871-1.408-3.568 0-1.697.886-2.529 1.204-2.872.261-.282.684-.424.897-.424.212 0 .424.004.609.012.193.008.455-.072.712.545.261.626.897 2.188.974 2.344.077.156.128.337.026.545-.102.208-.153.337-.308.513-.153.176-.324.394-.461.528-.154.148-.315.309-.136.618.179.309.796 1.314 1.708 2.128.878.783 1.615 1.025 2.018 1.187.404.162.64.135.879-.142.239-.277 1.026-1.192 1.301-1.602.274-.41.547-.337.915-.201.368.136 2.333 1.1 2.735 1.299.401.199.667.298.761.46.094.162.094.942-.118 1.543z" />
                        </svg>
                        Pesan via WhatsApp
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/products.js"></script>
    <script src="js/customer.js"></script>
    <script>
        function changeRole() {
            localStorage.removeItem('userRole');
            window.location.href = 'index.html';
        }

        // Exposed functions for non-module script access
        window.toggleCartSidebar = () => {
            document.getElementById('cart-sidebar').classList.toggle('translate-x-full');
        };
        window.closeCheckoutModal = () => {
            document.getElementById('checkout-modal').classList.add('hidden');
        };
        window.showCheckoutForm = () => {
            if (parseInt(document.getElementById('cart-count').innerText) === 0) {
                alert('Keranjang masih kosong!');
                return;
            }
            document.getElementById('checkout-modal').classList.remove('hidden');
        };
    </script>
</body>

</html>